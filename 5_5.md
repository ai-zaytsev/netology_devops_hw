#!/bin/bash
[[ $(id -u) -ne 0 ]] && { echo "Please, run script as with sudo"; exit 1; }

PREFIX="${1:-NOT_SET}"
INTERFACE="$2"

regex="^(\d|[1-9][0-9]|1\d\d|2[0-5][0-5])\.(\d{1}|[1-9][0-9]|1\d\d|2[0-5][0-5])"

[[ "$PREFIX" = "NOT_SET" ]] && { echo "\$PREFIX must be passed as first positional argument"; exit 1; }

if ! [[ $PREFIX =~ $regex ]] ; then
  echo "Wrong \$PREFIX in ip address: \"$PREFIX\"" >&2; exit 1
fi

if [[ -z "$INTERFACE" ]]; then
    echo "\$INTERFACE must be passed as second positional argument"
    exit 1
fi

SUBNET="${3:-1}"
HOST="${4:-1}"

function if_numeric () 
{
  re="^[0-9]+$"
  if ! [[ $1 =~ $re ]] ; then
    echo "Argument is not a number" >&2; exit 1
  fi
}

function if_more_255 () 
{
  if [[ $1 -gt 255  ]] ; then
    echo "Cannot be more than 255" >&2; exit 1
  fi
}

if_numeric $SUBNET
if_numeric $HOST

if_more_255 $SUBNET
if_more_255 $HOST

for SUBNET in $(seq $SUBNET 255)
do
        for HOST in $(seq $HOST 255)
        do
                echo "[*] IP : ${PREFIX}.${SUBNET}.${HOST}"
                arping -c 3 -I "$INTERFACE" "${PREFIX}.${SUBNET}.${HOST}" 2> /dev/null
        done
done
